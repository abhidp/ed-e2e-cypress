retries: &retries
  retry:
    automatic:
    - exit_status: -1
      limit: 3

e2eSteps: &e2eSteps
  steps:
  - commands:
    - "pushd e2e-tests"
    - "./run-all-tests.sh"
    - "popd"
    label: ":test_tube: Running :cypress: E2E tests :test_tube:"
    key: "e2e-tests-${BUILDKITE_RETRY_COUNT}"
    agents:
    - "role=node12"
    parallelism: 14
    timeout_in_minutes: 30
    artifact_paths:
    - "e2e-tests/screenshots/**/*"
    - "e2e-tests/videos/**/*"
    - "e2e-tests/logs/*"
    plugins:
    - seek-oss/aws-sm#v2.3.1:
        json-to-env:
        - secret-id: "build-e2e-tests"
    retry:
      manual: false
      automatic:
      - exit_status: -1
        limit: 3

steps:
